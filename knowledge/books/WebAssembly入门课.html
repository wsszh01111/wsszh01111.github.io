<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>WebAssembly入门课 | Ceiling</title><meta name="description" content="Just My Blog :-p">
    <link rel="modulepreload" href="/assets/app.6a81c09a.js"><link rel="modulepreload" href="/assets/WebAssembly入门课.html.6ccc9469.js"><link rel="modulepreload" href="/assets/WebAssembly入门课.html.261efbda.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.f0d67481.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/index.md" class=""><!----><span class="site-name">Ceiling</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blogs/" class="" aria-label="博客"><!--[--><!--]--> 博客 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/knowledge/" class="router-link-active" aria-label="知识"><!--[--><!--]--> 知识 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/algorithms/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ideas/" class="" aria-label="想法"><!--[--><!--]--> 想法 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/wsszh01111" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blogs/" class="" aria-label="博客"><!--[--><!--]--> 博客 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/knowledge/" class="router-link-active" aria-label="知识"><!--[--><!--]--> 知识 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/algorithms/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ideas/" class="" aria-label="想法"><!--[--><!--]--> 想法 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/wsszh01111" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/knowledge/" class="router-link-active sidebar-item sidebar-heading active" aria-label="Knowledge"><!--[--><!--]--> Knowledge <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/books/" class="router-link-active sidebar-item active" aria-label="Books"><!--[--><!--]--> Books <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/books/%E3%80%8ACSS%E4%B8%96%E7%95%8C%E3%80%8B.html" class="sidebar-item" aria-label="《CSS世界》"><!--[--><!--]--> 《CSS世界》 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="WebAssembly入门课"><!--[--><!--]--> WebAssembly入门课 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#核心原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="核心原理"><!--[--><!--]--> 核心原理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#webassembly二进制层面的基本数据规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="WebAssembly二进制层面的基本数据规则"><!--[--><!--]--> WebAssembly二进制层面的基本数据规则 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#_07wasi" class="router-link-active router-link-exact-active sidebar-item" aria-label="07WASI"><!--[--><!--]--> 07WASI <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#_08与浏览器交互所需的web-api和js-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="08与浏览器交互所需的Web API和JS API"><!--[--><!--]--> 08与浏览器交互所需的Web API和JS API <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#wasm-浏览器加载流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wasm 浏览器加载流程"><!--[--><!--]--> Wasm 浏览器加载流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#wasm-javascript-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wasm JavaScript API"><!--[--><!--]--> Wasm JavaScript API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#wasm-web-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wasm Web API"><!--[--><!--]--> Wasm Web API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#wasm-运行时-runtime" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wasm 运行时（Runtime）"><!--[--><!--]--> Wasm 运行时（Runtime） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#wasm-与宿主环境的数据交互" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wasm 与宿主环境的数据交互"><!--[--><!--]--> Wasm 与宿主环境的数据交互 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#局限" class="router-link-active router-link-exact-active sidebar-item" aria-label="局限"><!--[--><!--]--> 局限 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#_09为前端框架赋能" class="router-link-active router-link-exact-active sidebar-item" aria-label="09为前端框架赋能"><!--[--><!--]--> 09为前端框架赋能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/knowledge/books/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE.html#_12已有的wasm运行时" class="router-link-active router-link-exact-active sidebar-item" aria-label="12已有的wasm运行时"><!--[--><!--]--> 12已有的wasm运行时 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/knowledge/css/" class="sidebar-item" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/css/display.html" class="sidebar-item" aria-label="display"><!--[--><!--]--> display <!--[--><!--]--></a><!----></li><li><a href="/knowledge/css/Replaced%20element.html" class="sidebar-item" aria-label="Replaced element"><!--[--><!--]--> Replaced element <!--[--><!--]--></a><!----></li><li><a href="/knowledge/css/writing-mode.html" class="sidebar-item" aria-label="writing-mode"><!--[--><!--]--> writing-mode <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/js/" class="sidebar-item" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/js/RegExp.html" class="sidebar-item" aria-label="RegExp"><!--[--><!--]--> RegExp <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/class.html" class="sidebar-item" aria-label="class"><!--[--><!--]--> class <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/parseInt.html" class="sidebar-item" aria-label="parseInt"><!--[--><!--]--> parseInt <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/module.html" class="sidebar-item" aria-label="module"><!--[--><!--]--> module <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/bind.html" class="sidebar-item" aria-label="bind"><!--[--><!--]--> bind <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/toFixed%20and%20toExponential.html" class="sidebar-item" aria-label="toFixed and toExponential"><!--[--><!--]--> toFixed and toExponential <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/Trailing%20commas.html" class="sidebar-item" aria-label="Trailing commas"><!--[--><!--]--> Trailing commas <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/Encoding%20function.html" class="sidebar-item" aria-label="Encoding function"><!--[--><!--]--> Encoding function <!--[--><!--]--></a><!----></li><li><a href="/knowledge/js/Currying.html" class="sidebar-item" aria-label="Currying"><!--[--><!--]--> Currying <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/vue/" class="sidebar-item" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/vue/vue2" class="sidebar-item" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/vue/vue2/Reactive%20in%20vue2.html" class="sidebar-item" aria-label="Reactive in vue2"><!--[--><!--]--> Reactive in vue2 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/vue/vue3" class="sidebar-item" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/vue/vue3/Composition%20API.html" class="sidebar-item" aria-label="Composition API"><!--[--><!--]--> Composition API <!--[--><!--]--></a><!----></li><li><a href="/knowledge/vue/vue3/Reactive%20in%20vue3.html" class="sidebar-item" aria-label="Reactive in vue3"><!--[--><!--]--> Reactive in vue3 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/vue/shared" class="sidebar-item" aria-label="Shared"><!--[--><!--]--> Shared <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/build/" class="sidebar-item" aria-label="Build"><!--[--><!--]--> Build <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/build/Webpack.md" class="sidebar-item" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/network/" class="sidebar-item" aria-label="Network"><!--[--><!--]--> Network <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/network/HTTPS.html" class="sidebar-item" aria-label="HTTPS"><!--[--><!--]--> HTTPS <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/node/" class="sidebar-item" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/node/Shebang.html" class="sidebar-item" aria-label="Shebang"><!--[--><!--]--> Shebang <!--[--><!--]--></a><!----></li><li><a href="/knowledge/node/npm%20scripts.html" class="sidebar-item" aria-label="npm scripts"><!--[--><!--]--> npm scripts <!--[--><!--]--></a><!----></li><li><a href="/knowledge/node/npx.html" class="sidebar-item" aria-label="npx"><!--[--><!--]--> npx <!--[--><!--]--></a><!----></li><li><a href="/knowledge/node/API.html" class="sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><li><a href="/knowledge/node/require.html" class="sidebar-item" aria-label="require"><!--[--><!--]--> require <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/knowledge/others/" class="sidebar-item" aria-label="Others"><!--[--><!--]--> Others <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/knowledge/others/Tips.html" class="sidebar-item" aria-label="Tips"><!--[--><!--]--> Tips <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Rust.html" class="sidebar-item" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Browser%20pre-execute.html" class="sidebar-item" aria-label="Browser pre-execute"><!--[--><!--]--> Browser pre-execute <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Programming%20paradigm.html" class="sidebar-item" aria-label="Programming paradigm"><!--[--><!--]--> Programming paradigm <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Electron%20Model.html" class="sidebar-item" aria-label="Electron Model"><!--[--><!--]--> Electron Model <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/System%20Environment.html" class="sidebar-item" aria-label="System Environment"><!--[--><!--]--> System Environment <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Monorepo.html" class="sidebar-item" aria-label="Monorepo"><!--[--><!--]--> Monorepo <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Process%20and%20thread.html" class="sidebar-item" aria-label="Process and thread"><!--[--><!--]--> Process and thread <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/Big%20O.html" class="sidebar-item" aria-label="Big O"><!--[--><!--]--> Big O <!--[--><!--]--></a><!----></li><li><a href="/knowledge/others/GUN.html" class="sidebar-item" aria-label="GUN"><!--[--><!--]--> GUN <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="webassembly入门课" tabindex="-1"><a class="header-anchor" href="#webassembly入门课" aria-hidden="true">#</a> WebAssembly入门课</h1><p>极客时间<a href="https://time.geekbang.org/column/intro/100059901" target="_blank" rel="noopener noreferrer">WebAssembly入门课<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的部分笔记</p><h2 id="核心原理" tabindex="-1"><a class="header-anchor" href="#核心原理" aria-hidden="true">#</a> 核心原理</h2><h3 id="webassembly二进制层面的基本数据规则" tabindex="-1"><a class="header-anchor" href="#webassembly二进制层面的基本数据规则" aria-hidden="true">#</a> WebAssembly二进制层面的基本数据规则</h3><p>即WebAssembly针对不同数据类型有不同的编码方式</p><h4 id="字节序" tabindex="-1"><a class="header-anchor" href="#字节序" aria-hidden="true">#</a> 字节序</h4><p>Little-Endian：低地址位对应低数据位</p><p>Big-Endian：低地址位对应高数据位</p><h4 id="leb-128-整数编码" tabindex="-1"><a class="header-anchor" href="#leb-128-整数编码" aria-hidden="true">#</a> LEB-128 整数编码</h4><p>LEB-128 的全称为 “Little Endian Base 128”，是一种用于整数的、基于小端模式的可变长编码</p><p>Unsigned LEB-128/Signed LEB-128</p><h4 id="ieee-754" tabindex="-1"><a class="header-anchor" href="#ieee-754" aria-hidden="true">#</a> IEEE-754</h4><h4 id="utf-8-字符串编码" tabindex="-1"><a class="header-anchor" href="#utf-8-字符串编码" aria-hidden="true">#</a> UTF-8 字符串编码</h4><h4 id="wasm-数字类型" tabindex="-1"><a class="header-anchor" href="#wasm-数字类型" aria-hidden="true">#</a> Wasm 数字类型</h4><h2 id="_07wasi" tabindex="-1"><a class="header-anchor" href="#_07wasi" aria-hidden="true">#</a> 07WASI</h2><p>WebAssembly System Interface，WebAssembly 操作系统接口</p><h4 id="capability-based-security" tabindex="-1"><a class="header-anchor" href="#capability-based-security" aria-hidden="true">#</a> Capability-based Security</h4><p>Capability-based Security 是一种已知的、常用的安全模型。通常来讲，在计算机领域中，我们所提及的 capability 可以指代如 Token、令牌等概念。capability 是一种用于表示某种权限的标记，它可以在用户之间进行传递且无法被伪造。</p><h2 id="_08与浏览器交互所需的web-api和js-api" tabindex="-1"><a class="header-anchor" href="#_08与浏览器交互所需的web-api和js-api" aria-hidden="true">#</a> 08与浏览器交互所需的Web API和JS API</h2><p>Wasm 核心标准（Core Interfaces）以及嵌入接口标准（Embedding interfaces），与浏览器的交互标准主要是嵌入接口标准。JavaScript API 提供了众多的包装类型，这样便能够在 JavaScript 环境中表示 Wasm 模块的不同组成部分；还提供了代表wasm各个解析阶段的api</p><h3 id="wasm-浏览器加载流程" tabindex="-1"><a class="header-anchor" href="#wasm-浏览器加载流程" aria-hidden="true">#</a> Wasm 浏览器加载流程</h3><p>一个wasm二进制模块大致经过四个流程才能最终被浏览器使用</p><ul><li>Fetch：通过HTTP将wasm二进制模块加载到浏览器中</li><li>Compile：wasm字节码-&gt;平台相关代码，还未执行</li><li>Instantiate：执行上一步Compile后的代码，导入Import Section所定义的宿主资源资源，生成wasm模块实例</li><li>Call：调用wasm模块实例导出的函数</li></ul><h3 id="wasm-javascript-api" tabindex="-1"><a class="header-anchor" href="#wasm-javascript-api" aria-hidden="true">#</a> Wasm JavaScript API</h3><h4 id="模块对象" tabindex="-1"><a class="header-anchor" href="#模块对象" aria-hidden="true">#</a> 模块对象</h4><p><code>WebAssembly.Module</code>：对应Compile阶段完成后生成的wasm模块</p><p><code>WebAssembly.Instance</code>：对应Instantiate阶段完成后生成的wasm模块实例</p><p><code>WebAssembly.Module</code>和<code>WebAssembly.Instance</code>可以作为构造函数，生成对应的wasm模块和wasm模块实例</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// &quot;...&quot; 为包含有效的 Wasm 二进制字节码数据的ArrayBuffer或是TypedArray；</span>
<span class="token keyword">let</span> bufferSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Module</span><span class="token punctuation">(</span>bufferSource<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据wasm字节码生成的wasm模块对象 即module是一个模块</span>
<span class="token keyword">let</span> bufferSource2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> moduleInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Instance</span><span class="token punctuation">(</span>bufferSource2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成一个wasm模块实例 即moduleInstance是一个由模块实例化之后生成的模块实例</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="导入对象" tabindex="-1"><a class="header-anchor" href="#导入对象" aria-hidden="true">#</a> 导入对象</h4><p>wasm模块可以在实例化时接收宿主环境提供的数据</p><p>浏览器作为wasm最主要的宿主环境，以JSAPI的方式定义了（在Import Section中声明的）能够被导入到wasm模块中的数据类型，分别是函数（JS Function）、全局数据（<code>WebAssembly.Global</code>）、线性内存对象（<code>WebAssembly.Memory</code>）以及 Table 对象（<code>WebAssembly.Table</code>）</p><p>同<code>WebAssembly.Module</code>和<code>WebAssembly.Instance</code>，<code>WebAssembly.Global</code>、<code>WebAssembly.Memory</code>和<code>WebAssembly.Table</code>也可以作为构造函数来创建js对象</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Memory</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">initial</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">maximum</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="错误对象" tabindex="-1"><a class="header-anchor" href="#错误对象" aria-hidden="true">#</a> 错误对象</h4><p>JSAPI中还提供了几个错误对象，用来对应在wasm模块加载、编译、实例化、运行的各个阶段发生的错误</p><ul><li><p><code>WebAssembly.CompileError</code> 表示在 Wasm 模块编译阶段（Compile）发生的错误，比如模块的字节码编码格式错误、魔数不匹配</p></li><li><p><code>WebAssembly.LinkError</code> 表示在 Wasm 模块实例化阶段（Instantiate）发生的错误，比如导入到 Wasm 模块实例 Import Section 的内容不正确</p></li><li><p><code>WebAssembly.RuntimeError</code> 表示在 Wasm 模块运行时阶段（Call）发生的错误，比如常见的“除零异常”</p></li></ul><h4 id="模块实例化函数" tabindex="-1"><a class="header-anchor" href="#模块实例化函数" aria-hidden="true">#</a> 模块实例化函数</h4><p><code>WebAssembly.instantiate(bufferSource, importObject)</code>可以wasm二进制字节码实例化成一个wasm模块对象（即进行了编译和实例化两步），根据入参不同，其返回结果也有所差异，详见MDN上的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly" target="_blank" rel="noopener noreferrer">API文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="模块编译函数" tabindex="-1"><a class="header-anchor" href="#模块编译函数" aria-hidden="true">#</a> 模块编译函数</h4><p><code>WebAssembly.compile(bufferSource)</code>可以单独进行Compile编译步骤，返回一个编译好的静态WebAssembly.Module对象</p><h3 id="wasm-web-api" tabindex="-1"><a class="header-anchor" href="#wasm-web-api" aria-hidden="true">#</a> Wasm Web API</h3><p>JSAPI中主要定义的是与wasm相关的类型和操作，这些类型和操作是平台无关的；除此之外，为了充分利用Web平台的特性，还以Web API的形式提供了新的、高性能的编译和实例化接口。</p><h4 id="模块流式实例化方法" tabindex="-1"><a class="header-anchor" href="#模块流式实例化方法" aria-hidden="true">#</a> 模块流式实例化方法</h4><p>WebAssembly.instantiateStreaming(source, importObject)，提前对wasm模块进行实例化（而不是从远程加载好的完整 Wasm 模块二进制数据（bufferSource）），能够提升整体效率</p><h4 id="模块流式编译方法" tabindex="-1"><a class="header-anchor" href="#模块流式编译方法" aria-hidden="true">#</a> 模块流式编译方法</h4><p>WebAssembly.compileStreaming(source)，提前进行编译</p><h3 id="wasm-运行时-runtime" tabindex="-1"><a class="header-anchor" href="#wasm-运行时-runtime" aria-hidden="true">#</a> Wasm 运行时（Runtime）</h3><p>每个wasm模块实例在运行时都会维护自己的调用栈，由wasm模块实例导出的函数在运行过程中会影响调用栈中的数据。</p><p>每个wasm模块实例还有它对应的由“Memory Section” 和 “Data Section”共同描述的线性内存段（在线性MVP下只能有一个），线性内存段中存储wasm模块实例所有可用的数据资源；这些数据资源可以是wasm模块实例在运行时产生的，也可以是在实例化时通过<code>WebAssembly.Memory</code>对象形式导入的</p><p>浏览器会将wasm模块实例的线性内存段和JS内存进行隔离，因此js不能直接访问和调用wasm中的数据，反之亦然；并且现行的MVP尚无垃圾回收相关标准，因此需要手动对线性内存段进行资源释放</p><p>wasm内存访问的安全性由“Bound Check”保证</p><h3 id="wasm-与宿主环境的数据交互" tabindex="-1"><a class="header-anchor" href="#wasm-与宿主环境的数据交互" aria-hidden="true">#</a> Wasm 与宿主环境的数据交互</h3><p>由于js内存段和wasm内存段是隔离的，因此一般有两种方式用来使用js环境中的数据</p><ol><li>对于简单（字符/数字值等）数据类型，可以选择将其视为全局数据，通过 “Import Section” 导入到模块中使用；</li><li>对于复杂数据，需要将其以“字节”（TypeArray）的形式，拷贝到模块实例的线性内存段中来使用。</li></ol><h3 id="局限" tabindex="-1"><a class="header-anchor" href="#局限" aria-hidden="true">#</a> 局限</h3><ol><li>无法引用宿主环境的不透明数据（数据结构和内容未知），如DOM；间接的解决方案是使用函数</li><li>大部分数据结构复制时需要编解码</li></ol><blockquote><p>就目前 MVP 标准而言，Wasm 模块的线性内存段是与外部宿主环境进行直接信息交换的最重要“场所”。</p></blockquote><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><p>目前 Wasm MVP 标准在 Web 浏览器上的能力：凡是能够使用 Wasm 来实现的功能，现阶段都可以通过 JavaScript 来实现；而能够使用 JavaScript 来实现的功能，其中部分还无法直接通过 Wasm 实现（比如调用 Web API）。</p><h2 id="_09为前端框架赋能" tabindex="-1"><a class="header-anchor" href="#_09为前端框架赋能" aria-hidden="true">#</a> 09为前端框架赋能</h2><h2 id="_12已有的wasm运行时" tabindex="-1"><a class="header-anchor" href="#_12已有的wasm运行时" aria-hidden="true">#</a> 12已有的wasm运行时</h2><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/knowledge/books/%E3%80%8ACSS%E4%B8%96%E7%95%8C%E3%80%8B.html" class="" aria-label="《CSS世界》"><!--[--><!--]--> 《CSS世界》 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.6a81c09a.js" defer></script>
  </body>
</html>
